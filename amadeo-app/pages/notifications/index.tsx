import Head from 'next/head';
import React, { useCallback, useState } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { getSession } from 'next-auth/client';
import { DataPagination, DataTable } from '../../components/_common';
import { useTranslations } from 'next-intl';
import Image from 'next/image';
import { PaginationType } from '../../constants';
import { fetchNotificationsAction } from '../../redux/notifications';
import {
    notififcationsCountSelector,
    paginatedNoticeSelector
} from '../../redux/notifications/selectors';
import { InputText } from '../../components/_form';

export default function Index() {
    const userProfileImg =
        'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80';
    const t = useTranslations();
    const dispatch = useDispatch();
    const [filterOpen, setFilterOpen] = useState(false);
    const count = useSelector(notififcationsCountSelector);
    const items = useSelector(paginatedNoticeSelector);
    console.log(items[3])
    const sendRequest = useCallback(() => {
        return dispatch(fetchNotificationsAction());
    }, [dispatch]);

    return (
        <>
            <Head>
                <title>Amadeo CRM - Personal Information</title>
                <meta name="description" content="Generated by create next app" />
            </Head>

            <div className="block-white-8 mr-10 white-shadow-big">
                <div className="page-title">
                    <h1>{t('Notifications')}</h1>
                </div>

                <div className="text-gray-400">
                    {t('Lorem ipsum — классический текст-«рыба». Является искажённым отрывком из философского трактата Марка Туллия Цицерона «О пределах добра и зла», написанного в 45 году до н. э. на латинском языке')}
                </div>
            </div>

            <div className="flex mt-10 block-white-8 white-shadow-big">
                <div className="w-80 p-4 bg-gray-100 rounded-lg shadow-inner">
                    <div className="mb-10 font-bold text-gray-350 text-lg pb-4 border-b border-gray-200">
                        {t('Notification settings')}
                    </div>
                    <div className="mb-8">
                        <div className="mb-2 font-bold text-blue-350">{t('Order confirmed')}</div>
                        <div className="text-gray-500 text-xs">{t('You will be notified whenewer a customer orders any product')}</div>
                    </div>
                    <div className="mb-8">
                        <div className="mb-2 font-bold text-blue-350">{t('Order status changed')}</div>
                        <div className="text-gray-500 text-xs">{t('You will be notified whenewer a customer makes any changes to an order')}</div>
                    </div>
                    <div className="mb-8">
                        <div className="mb-2 font-bold text-blue-350">{t('Order delivered')}</div>
                        <div className="text-gray-500 text-xs">{t('You will be notified once the order has been delivered')}</div>
                    </div>
                    <div className="mb-8">
                        <div className="mb-2 font-bold text-blue-350">{t('Email notification')}</div>
                        <div className="text-gray-500 text-xs">{t('You will be notified whenewer a customer makes any changes to an order')}</div>
                    </div>
                    <button className="gradient-btn w-full">{t('Save changes')}</button>

                </div>
                <div className="mt-4 ml-6 w-full">
                    <div className="mb-14 relative">
                        {filterOpen && (
                            <div className="-top-14 bg-white absolute right-36 w-80 p-6 shadow-xl rounded-3xl">
                                <div className="pb-3 border-b flex justify-between">
                                    <div className="text-gray-350 font-bold text-xl">
                                        {t('Filters')}
                                    </div>
                                </div>
                                <InputText
                                    style="mt-5 w-full"
                                    icon={''}
                                    label={null}
                                    name={'name'}
                                    placeholder={t('Start typing to search')}
                                    props={{
                                        values: { name: '' },
                                        errors: { name: '' }
                                    }}
                                    tips={null}
                                />
                                <div className="flex justify-between mb-2">
                                    <div className="flex items-center">
                                        <Image width="10" height="10" src={'/images/lang-arrow.svg'} />
                                        <span className="ml-2 text-xs font-bold text-blue-350">
                                            {t('Spent')}
                                        </span>
                                    </div>
                                    <div className="text-sm font-thin text-gray-450">999,99,9$</div>
                                </div>
                                <input
                                    className="w-full"
                                    type="range"
                                    min="0"
                                    max="100"
                                    step="1"
                                    value="50"
                                />
                                <div className="flex mt-1">
                                    <div className="w-1/2 mr-2">
                                        <div className="mb-3 text-xs font-bold text-blue-350">
                                            {t('Minimum')}
                                        </div>
                                        <InputText
                                            style="w-full"
                                            icon={''}
                                            label={null}
                                            name={'name'}
                                            placeholder={t('0,00$')}
                                            props={{
                                                values: { name: '' },
                                                errors: { name: '' }
                                            }}
                                            tips={null}
                                        />
                                    </div>
                                    <div className="w-1/2">
                                        <div className="mb-3 text-xs font-bold text-blue-350">
                                            {t('Maximum')}
                                        </div>
                                        <InputText
                                            style="w-full"
                                            icon={''}
                                            label={null}
                                            name={'name'}
                                            placeholder={t('999,999$')}
                                            props={{
                                                values: { name: '' },
                                                errors: { name: '' }
                                            }}
                                            tips={null}
                                        />
                                    </div>
                                </div>
                                <div className="flex justify-between mb-3">
                                    <div className="flex items-center">
                                        <Image width="10" height="10" src={'/images/lang-arrow.svg'} />
                                        <span className="ml-2 text-xs font-bold text-blue-350">
                                            {t('Country')}
                                        </span>
                                    </div>
                                    <div className="font-bold rounded-full text-center p-[2px] bg-green-250 text-xs h-5 w-5 text-white">
                                        3
                                </div>
                                </div>
                                <InputText
                                    style="w-full pb-4 border-b mb-6"
                                    icon={''}
                                    label={null}
                                    name={'name'}
                                    placeholder={t('Type to search for...')}
                                    props={{
                                        values: { name: '' },
                                        errors: { name: '' }
                                    }}
                                    tips={null}
                                />
                                <div className="flex items-center mb-3">
                                    <input
                                        id="acceptTerms"
                                        name="acceptTerms"
                                        className="text-green-250 border-green-250 w-5 h-5 border-2 rounded mr-2.5"
                                        type="checkbox"
                                    />
                                    <Image width="40" height="24" src={'/images/en-flag.svg'} />
                                    <span className="ml-2 text-xs font-bold text-blue-350">
                                        {t('America')}
                                    </span>
                                </div>
                                <div className="flex items-center mb-3">
                                    <input
                                        id="acceptTerms"
                                        name="acceptTerms"
                                        className="text-green-250 border-green-250 w-5 h-5 border-2 rounded mr-2.5"
                                        type="checkbox"
                                    />
                                    <Image width="40" height="24" src={'/images/fr-glag.svg'} />
                                    <span className="ml-2 text-xs font-bold text-blue-350">
                                        {t('France')}
                                    </span>
                                </div>
                            </div>
                        )}
                        <button
                            onClick={() => setFilterOpen(!filterOpen)}
                            className="absolute top-0 right-0 flex items-center text-sm border rounded-lg px-4 py-1">
                            <Image width={16} height={16} src={'/images/filter.svg'} />
                            <div className="font-medium text-gray-400 ml-2">{t('Filters')}</div>
                            <div className="ml-2 font-bold rounded-full p-[2px] text-center bg-gray-400 text-xs h-5 w-5 text-white">
                                9
                        </div>
                        </button>
                    </div>
                    <div className="mb-5 font-bold text-gray-350 text-lg pb-4 border-b border-gray-200">
                        {t('Earlier')}
                    </div>
                    <DataTable
                        paginationType={PaginationType.NOTIFICATIONS}
                        totalAmount={count}
                        sendRequest={sendRequest}
                        sendDeleteRequest={() => new Promise(() => null)}
                        sendCopyRequest={() => new Promise(() => null)}>
                        {items.map((item: any, index: number) => (
                            <tr key={index}>
                                <td>
                                    <input
                                        className="float-checkbox"
                                        type="checkbox"
                                        onChange={() => null}
                                        value={item.id}
                                        checked={false}
                                    />
                                </td>
                                <td>
                                    <div className="flex font-medium">
                                        <div className="relative w-7 h-7 mr-2">
                                            <Image
                                                className="rounded-full"
                                                layout="fill"
                                                src={userProfileImg}
                                            />
                                        </div>
                                        <div>
                                            <div className="font-bold">{item.first_name} {item.last_name}</div>
                                            <div className="font-light text-xs">username</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div className="font-medium">
                                        <div className="px-2 py-1 font-bold rounded-lg text-green-250 text-xs inline bg-green-50 border-2 border-green-250">{t('Paid')}</div>
                                        <div className="mt-3">{item.message}</div>
                                        <div className="mb-5 font-light text-gray-500 text-xs">{item.created_at}</div>
                                    </div>
                                </td>
                                <td>
                                    <button
                                        onClick={(e) => {

                                        }}
                                        className="ml-auto block">
                                        <Image
                                            width={24}
                                            height={24}
                                            src="/images/dots.svg"
                                            layout="fixed"
                                            alt=""
                                        />
                                    </button>
                                </td>
                            </tr>
                        ))}
                    </DataTable>
                </div>
            </div>
        </>
    );
}

export async function getServerSideProps(context: any) {
    const { locale } = context;
    const session = await getSession(context);

    if (!session) {
        return {
            redirect: { destination: `/${locale === 'fr' ? '' : `${locale}/`}auth/signin` }
        };
    }

    return {
        props: {
            session,
            locale,
            messages: {
                ...require(`../../messages/${locale}.json`)
            }
        }
    };
}
